{% extends 'base.html' %}

{% block content %}
<section class="panel">
  <h2>検索</h2>
  <form class="search-form" method="get" action="{{ url_for('search') }}">
    <div class="form-row">
      <label for="q">キーワード</label>
      <input id="q" name="q" type="text" value="{{ q }}" placeholder="タイトル / 本文" />
    </div>
    <div class="form-row">
      <label for="from">開始日</label>
      <input id="from" name="from" type="date" value="{{ date_from }}" />
    </div>
    <div class="form-row">
      <label for="to">終了日</label>
      <input id="to" name="to" type="date" value="{{ date_to }}" />
    </div>
    <div class="form-row">
      <label for="tag">タグ（場所/人物/物/色/匂い）</label>
      <input id="tag" name="tag" type="text" value="{{ tag }}" placeholder="例: 学校" />
    </div>
    <div class="form-actions">
      <button type="submit">検索</button>
      <a class="button ghost" href="{{ url_for('search') }}">リセット</a>
    </div>
  </form>
</section>

<section>
  <h2>夢一覧</h2>
  {% if dreams %}
    <div class="dream-list">
      {% for dream in dreams %}
        <article class="dream-card">
          {% if dream['image_path'] %}
            <img class="list-thumb" src="{{ url_for('static', filename=dream['image_path']) }}" alt="dream image" />
          {% endif %}
          <div class="dream-card-header">
            <h3><a href="{{ url_for('detail', dream_id=dream['dream_id']) }}">{{ dream['title'] }}</a></h3>
            <span class="date">{{ dream['date'] }}</span>
          </div>
          <p class="dream-body">{{ dream['body'][:160] }}{% if dream['body']|length > 160 %}...{% endif %}</p>
          <div class="meta">
            <span>吉夢/悪夢: {% if dream['mood'] is none %}-{% elif dream['mood'] >= 1 %}吉夢{% elif dream['mood'] <= -1 %}悪夢{% else %}中立{% endif %}</span>
            <span>鮮明度: {{ dream['vividness'] if dream['vividness'] is not none else '-' }}</span>
          </div>
          <div class="tags">場所: {{ dream['location'] if dream['location'] else '-' }} / 人物: {{ dream['people'] if dream['people'] else '-' }} / 物: {{ dream['thing'] if dream['thing'] else '-' }} / 色: {{ dream['color'] if dream['color'] else '-' }} / 匂い: {{ dream['smell'] if dream['smell'] else '-' }}</div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">該当する夢がありません。</p>
  {% endif %}
</section>
{% endblock %}
